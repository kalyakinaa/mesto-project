(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"1f520b4d-df0f-445b-8e0c-d6ab7cd25a60","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};var r=document.querySelector(".profile__image");document.querySelector(".header__logo").src="fc3e6875d825f899a98d.svg";var n=document.querySelector(".places__list");function o(r,n){var o=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=document.querySelector(".popup_type_image");c.addEventListener("click",i);var u=o.querySelector(".card__like-count"),d=o.querySelector(".card__delete-button"),l=o.querySelector(".card__like-button");return o.querySelector(".card__image").src=r.link,o.querySelector(".card__image").alt=r.name,o.querySelector(".card__title").textContent=r.name,u.textContent=r.likes.length,r.owner._id!==n&&(d.style.visibility="hidden"),d.addEventListener("click",(function(){var n;(n=r._id,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then(t)).then((function(){o.remove()})).catch((function(e){console.error("deleteCard() error: ".concat(e))}))})),r.likes.some((function(e){return e._id===n}))&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(function(){var n;l.classList.contains("card__like-button_is-active")?(n=r._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)).then((function(e){l.classList.remove("card__like-button_is-active"),u.textContent=e.likes.length})).catch((function(e){console.error("unlikeCard() error:",e)})):function(r){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:e.headers}).then(t)}(r._id).then((function(e){l.classList.add("card__like-button_is-active"),u.textContent=e.likes.length})).catch((function(e){console.error("likeCard() error:",e)}))})),c.classList.add("popup_is-animated"),o.querySelector(".card__image").addEventListener("click",(function(){var e=c.querySelector(".popup__image"),t=c.querySelector(".popup__caption");e.src=r.link,e.alt=r.name,t.textContent=r.name,a(c)})),o}function a(e){e.classList.add("popup_is-opened")}function c(e){e.classList.remove("popup_is-opened")}function i(e){e.target.classList.contains("popup")&&c(e.target)}document.addEventListener("keydown",(function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&c(t)}})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(e){c(e.target.closest(".popup"))}))}));var u=document.querySelector(".popup_type_new-avatar");u.addEventListener("click",i);var d=u.querySelector(".popup__form"),l=d.querySelector(".popup__input_type_url"),s=d.querySelector(".popup__button");function p(){l.validity.valid?(s.classList.remove("popup__button_inactive"),s.disabled=!1):(s.classList.add("popup__button_inactive"),s.disabled=!0)}r.addEventListener("click",(function(){l.value="",l.validity.valid?w(l):T(l),p(),a(u)})),u.querySelector(".popup__close").addEventListener("click",(function(){c(u)})),d.addEventListener("submit",(function(n){var o;n.preventDefault(),(o=l.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(t)).then((function(e){r.style.backgroundImage="url(".concat(e.avatar,")"),c(u),d.reset()})).catch((function(e){console.error("updateAvatar() error: ".concat(e))}))}));var _=document.querySelector(".popup_type_edit");_.classList.add("popup_is-animated"),_.addEventListener("click",i);var v=document.querySelector(".profile__edit-button"),f=_.querySelector(".popup__form"),y=_.querySelector(".popup__input_type_name"),m=_.querySelector(".popup__input_type_description"),h=(Array.from(f.querySelectorAll(".popup__input")),f.querySelector(".popup__button")),b=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),q=null;function L(){y.validity.valid&&m.validity.valid?(h.classList.remove("popup__button_inactive"),h.disabled=!1):(h.classList.add("popup__button_inactive"),h.disabled=!0)}fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t).then((function(e){b.textContent=e.name,S.textContent=e.about,r.style.backgroundImage="url(".concat(e.avatar,")"),q=e._id})).catch((function(e){console.error("getUser() error: ".concat(e))})),v.addEventListener("click",(function(){y.value=b.textContent,y.validity.valid?w(y):T(y),m.value=S.textContent,m.validity.valid?w(m):T(m),L(),a(_)})),f.addEventListener("submit",(function(r){var n;r.preventDefault(),(n={name:y.value,about:m.value},fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify(n)}).then(t)).then((function(e){console.log(e),b.textContent=e.name,S.textContent=e.about,c(_)})).catch((function(e){console.error("updateUser() error: ".concat(e))}))}));var k=document.querySelector(".popup_type_new-card");k.addEventListener("click",i);var g=document.querySelector(".profile__add-button"),E=k.querySelector(".popup__form"),C=k.querySelector(".popup__input_type_card-name"),x=k.querySelector(".popup__input_type_url"),U=(Array.from(E.querySelectorAll(".popup__input")),E.querySelector(".popup__button"));function A(){C.validity.valid&&x.validity.valid?(U.classList.remove("popup__button_inactive"),U.disabled=!1):(U.classList.add("popup__button_inactive"),U.disabled=!0)}function T(e){e.classList.add("popup__input_error");var t=document.querySelector(".".concat(e.id,"-error-message"));t.classList.add("popup__input_error-message_active"),t.textContent=e.validationMessage}function w(e){e.classList.remove("popup__input_error"),document.querySelector(".".concat(e.id,"-error-message")).classList.remove("popup__input_error-message_active")}fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t).then((function(e){e.forEach((function(e){n.append(o(e,q))}))})).catch((function(e){console.error("getInitialCards() error: ".concat(e))})),g.addEventListener("click",(function(){C.value="",C.validity.valid?w(C):T(C),x.value="",x.validity.valid?w(x):T(x),A(),a(k)})),Array.from(document.querySelectorAll(".popup__input")).forEach((function(e){e.addEventListener("input",(function(e){e.target.validity.valid?w(e.target):T(e.target),p(),L(),A()}))})),E.addEventListener("submit",(function(r){var a;r.preventDefault(),(a={name:C.value,link:x.value},fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify(a)}).then(t)).then((function(e){n.prepend(o(e,q)),c(k)})).catch((function(e){console.error("addNewCard() error: ".concat(e))}))}))})();